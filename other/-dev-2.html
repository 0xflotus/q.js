<!DOCTYPE html>
<html>
	<head>
		<title>Q ‚ü© Playground</title>
		<meta charset="utf-8">
		<meta name="viewport"             content="width=device-width,initial-scale=1.0">
		<meta name="description"          content="Quantum computing in your browser.">
		<meta name="copyright"            content="Stewart Smith 2019‚Äì2020">
		<meta name="keywords"             content="
			Q, Q.js, Q-js, Qjs, quantum JavaScript,
			quantum, quantum physics, quantum mechanics, superposition,
			quantum computer, quantum computer programming, quantum computing, QC, 
			quantum simulator, quantum computer simulator, 
			qubit, qbit, gate, Hadamard, Bloch, Bloch Sphere,
			Web, Web site, website, Web browser, browser, HTML, HTML5, JavaScript, ES6, CSS,
			Chrome, Firefox, Safari, Opera, Brave, Edge, WebKit, Blink,
			Stewart Smith, Stewart, Stew, Stuart, Steven, Steve, Stewdio, stew_rtsmith, @stew_rtsmith,
			Moar, Moar Technologies Corp, MTC,
			Google, IBM, Microsoft, Amazon, NASA, DWave, D-Wave,
			Quil, OpenQASM,
				ProjectQ, Qiskit, 
				Quantum Development Kit, Cirq, Strawberry Fields, t|ket>,
				QCL, Quantum pseudocode, Q#, Q|SI>, Q language, qGCL, QFC, QML, LIQUi|>, Quipper,
			Stanford CS 269 Q: Quantum Computer Programming">
		
		<meta name="twitter:card"         content="summary_large_image">
		<meta name="twitter:site"         content="@stew_rtsmith">
		<meta name="twitter:creator"      content="@stew_rtsmith">
		<meta name="twitter:title"        content="Q ‚ü© Playground">
		<meta name="twitter:description"  content="Quantum computing in your browser.">
		<meta name="twitter:image"        content="https://stewdio.github.io/q.js/other/q-thumbnail.png">
		
		<meta property="og:type"          content="website">
		<meta property="og:title"         content="Q ‚ü© Playground">
		<meta property="og:description"   content="Quantum computing in your browser.">
		<meta property="og:image"         content="https://stewdio.github.io/q.js/other/q-thumbnail.png">
		<meta property="og:url"           content="https://stewdio.github.io/q.js/playground.html">
		
		<!-- <link rel="canonical" href="https://stewdio.github.io/q.js/playground.html"> -->
		<link href="../other/q-favicon-064.png" rel="icon" type="image/png">
		<link href="../other/q-favicon-144.png" rel="apple-touch-icon">
		
		<link rel="stylesheet" type="text/css" href="../source/Q.css">
		<link rel="stylesheet" type="text/css" href="../source/Q-Circuit-Editor-NEW.css">
		<link rel="stylesheet" type="text/css" href="../other/documentation.css">

		<script src="https://www.googletagmanager.com/gtag/js" async></script>
		<script src="../other/ga.js"></script>				
		<script src="../source/Q.js"></script>
		<script src="../source/Q-ComplexNumber.js"></script>
		<script src="../source/Q-Matrix.js"></script>
		<script src="../source/Q-Qubit.js"></script>
		<script src="../source/Q-Gate.js"></script>
		<script src="../source/Q-Circuit.js"></script>
		<script src="../source/Q-Circuit-Editor.js"></script>
		<script src="../other/navigation.js"></script>
		
	</head>
	<body>
		<main>
			
			<div class="color-swatch cos" id="color-swatch-1">1</div
			><div class="color-swatch cos" id="color-swatch-2">2</div
			><div class="color-swatch cos" id="color-swatch-3">3</div
			><div class="color-swatch cos" id="color-swatch-4">4</div
			><div class="color-swatch cos" id="color-swatch-5">5</div>

			<h3>Playground</h3>
			<p>
				Type, paste, or edit your circuit here.
				Then tap ‚ÄúApply‚Äù to
				generate an interactive circuit diagram 
				and other output formats below.
				You can learn more about Q‚Äôs plain text format
				in <a href="Circuit.html#Writing_quantum_circuits">‚ÄúWriting quantum circuits.‚Äù</a>
			</p>
			<textarea class="Q-circuit-text-input" id="playground-input">I-I-I---I-I
I-H-X#0-I-I
I-I-X#1-I-I
I-I-I---I-I</textarea>
			<p class="right">
				<button class="Q-button" id="playground-apply-button" type="button" onclick="updatePlaygroundFromText()">
					Apply
				</button>
				<br><br>
			</p>
			







<div class="Q-circuit-palette">
	<div class="Q-circuit-cell Q-circuit-operation Q-circuit-operation-hadamard">H</div>
	<div class="Q-circuit-cell Q-circuit-operation Q-circuit-operation-pauli-x">X</div>
	<div class="Q-circuit-cell Q-circuit-operation Q-circuit-operation-pauli-y">Y</div>
	<div class="Q-circuit-cell Q-circuit-operation Q-circuit-operation-pauli-z">Z</div>
	<div class="Q-circuit-cell Q-circuit-operation Q-circuit-operation-phase">S</div>
</div>
<br>
<div class="Q-circuit" id="my-sample-circuit">
	<div class="Q-circuit-board-container">
		<div class="Q-circuit-board">

			<div class="Q-circuit-board-background">
				<!-- 
				wires<br>
				vertical grid lines (intersect on ops)<br>
				background colors? -->
			</div>
			<div class="Q-circuit-board-foreground">
				
				<div class="Q-circuit-cell Q-circuit-header Q-circuit-selectall">&searr;</div>
				<div class="Q-circuit-cell Q-circuit-header Q-circuit-input-header"></div>
				<div class="Q-circuit-cell Q-circuit-header Q-circuit-moment-index" style="grid-column: 3" title="Moment 1">1</div>
				<div class="Q-circuit-cell Q-circuit-header Q-circuit-moment-index" style="grid-column: 4" title="Moment 2">2</div>
				<div class="Q-circuit-cell Q-circuit-header Q-circuit-moment-index" style="grid-column: 5" title="Moment 3">3</div>
				<div class="Q-circuit-cell Q-circuit-header Q-circuit-moment-index" style="grid-column: 6" title="Moment 4">4</div>
				<div class="Q-circuit-cell Q-circuit-header Q-circuit-moment-index-add" style="grid-column: 7">+</div>
				
				<div class="Q-circuit-cell Q-circuit-header Q-circuit-register-index" style="grid-row: 2" title="Register 1">1</div>
				<div class="Q-circuit-cell Q-circuit-input" style="grid-row: 2">0</div>
				<div class="Q-circuit-cell Q-circuit-header Q-circuit-register-index" style="grid-row: 3" title="Register 2">2</div>
				<div class="Q-circuit-cell Q-circuit-input" style="grid-row: 3">0</div>

<div class="Q-circuit-cell Q-circuit-header Q-circuit-register-index" style="grid-row: 4" title="Register 3">3</div>
				<div class="Q-circuit-cell Q-circuit-input" style="grid-row: 4">0</div>
				<div class="Q-circuit-cell Q-circuit-header Q-circuit-register-index-add" style="grid-row: 5">+</div>


				<div class="Q-circuit-cell Q-circuit-operation Q-circuit-operation-hadamard" style="grid-column: 3; grid-row: 2">H</div>
				<div class="Q-circuit-cell Q-circuit-operation Q-circuit-operation-control" style="grid-column: 4; grid-row: 2">.</div>
				<div class="Q-circuit-cell Q-circuit-operation Q-circuit-operation-target" style="grid-column: 4; grid-row: 3">X</div>
				<div class="Q-circuit-cell Q-circuit-operation Q-circuit-operation-pauli-x" style="grid-column: 5; grid-row: 2">X</div>
				<div class="Q-circuit-cell Q-circuit-operation Q-circuit-operation-pauli-x" style="grid-column: 5; grid-row: 3">X</div>
				<div class="Q-circuit-cell Q-circuit-operation Q-circuit-operation-phase" style="grid-column: 6; grid-row: 4">S</div>
			</div>
		</div>
	</div>
	<div class="Q-circuit-toolbar">
		<div class="Q-circuit-button" title="Lock / unlock">
			üîí
		</div
		><div class="Q-circuit-button" title="Undo">
			&larr;
		</div
		><div class="Q-circuit-button" title="Redo">
			&rarr;
		</div
		><div class="Q-circuit-button" title="Add moment">
			+m
		</div
		><div class="Q-circuit-button" title="Add register">
			+r
		</div>
	</div>
</div>
<script>



document
// .getElementById( 'my-sample-circuit' )
.querySelector( '#my-sample-circuit .Q-circuit-board-foreground' )
.addEventListener( 'mousedown', function( event ){


	const circuit = event.target.closest( '.Q-circuit' )
	console.log( 'circuit', circuit )
	console.log( 'circuit scrollLeft', circuit.scrollLeft )
	console.log( 'circuit scrollTop', circuit.scrollTop )

	const operation = event.target.closest( '.Q-circuit-operation' )
	if( operation ){
	
		console.log( 'operation', operation )
		// const computed = window.getComputedStyle( operation )		
		// console.log( 'computed', computed )		
		console.log( 'operation register index', +operation.style.gridRowStart - 1 )
		console.log( 'operation moment index', +operation.style.gridColumnStart - 2 )
	}


	// console.log( event ) 

	// console.log( 'target', event.target.scrollLeft  )
	// console.log( 'parent', event.target.parentNode.scrollLeft  )
	// console.log( 'grandparent', event.target.parentNode.parentNode.scrollLeft  )

	// console.log( 'taget', event.target )
	// console.log( 'parent', event.target.parentNode  )
	// console.log( 'grandparent', event.target.parentNode.parentNode  )
})



</script>





			<!-- <div id="playground-dom"></div> -->


			<h4>Result probabilities</h4>
			<p>
			</p>
			<pre><samp id="playground-report"></samp></pre>


			<h4>Circuit as ASCII diagram</h4>
			<p>
				This can be particularly helpful within the JavaScript console
				when you need to double check the composition of a circuit
				in a way that‚Äôs more illustrative than simple plain text.
			</p>
			<pre><samp id="playground-diagram"></samp></pre>


			<!-- h4>Circuit as Amazon Braket code</h4>
			<p>
				This code can be copied and then pasted in to an
				<a href="https://aws.amazon.com/braket/" target="_blank">Amazon Braket</a> Jupyter notebook
				to be run on a cloud-based simulator
				or actual quantum hardware.
				(Requires an 
				<a href="https://aws.amazon.com/" target="_blank">AWS account</a> and fees may apply.)
			</p>
			<pre><samp id="playground-braket"></samp></pre -->


			<h4>Circuit as LaTeX code</h4>
			<p>
				This code can be used within 
				<a href="https://www.latex-project.org/" target="_blank">LaTeX</a> with the 
				<a href="https://ctan.org/pkg/qcircuit?lang=en" target="_blank">QCircuit</a>
				library to create circuit diagrams.
				Note that <code>ctrl{}</code> commands do not yet contain valid index values.
				<span class="coming-soon">Check back in May 2020.</span>
			</p>
			<pre><samp id="playground-latex"></samp></pre>


			<h4>Circuit as plain text</h4>
			<p>
				If all‚Äôs gone well
				then copying this and pasting this code 
				in to the original text input box 
				should have no effect on the maths.
			</p>
			<pre><samp id="playground-text"></samp></pre>
			<hr>
			<h3>Sample circuits</h3>
			<p>
				This page previously contained the following pre-loaded sample circuits for experimenting with.
				Their plain text representations are included here for reference.
				(You can copy and paste their text in to the input field at the top of the page to load them.)
			</p>
			<h4>Bell state</h4>
			<p>
				Here‚Äôs a <a href="https://en.wikipedia.org/wiki/Bell_state" target="_blank">Bell state</a>
				(which produces <a href="https://en.wikipedia.org/wiki/Quantum_entanglement" target="_blank">quantum entanglement</a>), 
				but with 
				<a href="Gate.html#.PAULI_X">Pauli X</a>
				operations added to both registers as a finale‚Äîso
				the only two possible results are 
				<span class="complex-vector ket">00</span>
				and
				<span class="complex-vector ket">11</span>; all or nothing!
			</p>
<pre><code>
H X#0 X
I X#1 X</code></pre>
			<h4>Whiplash</h4>
			<p>
				This monster demonstrates some
				overlapping multi-register operations
				and an  ‚Äúupside-down CNOT‚Äù finale.
				Notice too how in the diagram version
				the boxes within each column (moment) are equal widths
				and there‚Äôs an attempt to center the text labels within their boxes.
				Also note how the overlapping connectors are dealt with, eh?
				Of course this circuit would make little sense in the real world.
				It‚Äôs here purely to test different aspects of rendering a circuit visually.
			</p>
			<!-- p>
				Also‚Äîhave you noticed that you can drag operations from one circuit to another?
				You‚Äôll have to get creative with scrolling,
				but you can drag operations between here and the Bell state above ;)
			</p -->
<pre><code>
H  X.0#0  Y    Z    X#1
H  X.1#0  X#0  I    X#0
H  X.0#1  Y    X#0  S
H  X      X#1  X#1  I
H  X.1#1  Y    Z    S</code></pre>
		</main>
		<script>




//  This is purely to make exploring from 
//  the JavaScript console possible.
//  It is not necessary at all for everything
//  else on this page to function.

let playground




//  Let‚Äôs place circuit palettes
//  inside anything with the class '.qjs-circuit-palette'.

Array.from( document.querySelectorAll( '.qjs-circuit-palette' )).forEach( function( el ){

	Q.Circuit.createDomPalette( el )
})




function applyButtonActivated(){

	const button = document.getElementById( 'playground-apply-button' )
	if( button && button.getAttribute( 'disabled' ) === null ) updatePlaygroundFromText()
}

let playgroundInputText = ''

function hasTextInputUpdated(){

	const 
	input  = document.getElementById( 'playground-input' ).value
	button = document.getElementById( 'playground-apply-button' )
	
	if( input === playgroundInputText ){

		button.setAttribute( 'disabled', 'disabled' )
	}
	else button.removeAttribute( 'disabled' )
}




//  When our user edits the plain text input
//  we want to update our interactive circuit
//  and exported code accordingly.

function updatePlaygroundFromText(){

	const text = document.getElementById( 'playground-input' ).value
	if( text !== playgroundInputText ){

		playgroundInputText = text
		document.getElementById( 'playground-apply-button' ).setAttribute( 'disabled', 'disabled' )
	
		const circuit = Q( text )
		if( circuit instanceof Q.Circuit ){

			circuit.name = 'playground'
			playground = circuit
			const domEl = document.getElementById( circuit.name +'-dom' )
			if( domEl ){

				while( domEl.lastChild) {
					
					domEl.removeChild( domEl.lastChild )
				}
				circuit.sort$()//  Is this still necessary??
				circuit.toDom( domEl )
			}
			updateCircuitParts( circuit )
		}
		else {

			updateCircuitParts( Q`I` )
			console.log( 'There‚Äôs an error in your circuit!!' )
		}
	}
}


//  When our user edits the interactive circuit
//  we want to update 

function updatePlaygroundFromDom( circuit ){

	const inputEl = document.getElementById( circuit.name +'-input' )
	if( inputEl ){

		const text = circuit.toText().substr( 1 )
		inputEl.value = text
		updateCircuitParts( circuit )
		playgroundInputText = text
	}
}


//  Update all the export code and probabilities report.

function updateCircuitParts( circuit ){

	// const braketEl = document.getElementById( circuit.name +'-braket' )
	// if( braketEl ) braketEl.innerText = '\n'+ circuit.toAmazonBraket( true )

	const latexEl = document.getElementById( circuit.name +'-latex' )
	if( latexEl ) latexEl.innerText = '\n'+ circuit.toLatex( true )

	const diagramEl = document.getElementById( circuit.name +'-diagram' )
	if( diagramEl ) diagramEl.innerText = circuit.toDiagram( true )
	
	const textEl = document.getElementById( circuit.name +'-text' )
	if( textEl ) textEl.innerText = circuit.toText()

	const reportEl = document.getElementById( circuit.name +'-report' )
	if( reportEl ) reportEl.innerText = circuit.report$()
}





window.addEventListener( 'DOMContentLoaded', function(){

	// updateEverything( bell )
	// updateEverything( whiplash )
	updatePlaygroundFromText()
	setInterval( hasTextInputUpdated, 100 )
})








//  EVALUATION.

window.addEventListener( 'qjs evaluate began', function( event ){

	console.log( 

		'\n\nBeginning evaluation for ‚Äú'+ event.detail.circuit.name +'‚Äù\n'+
		event.detail.circuit.toDiagram() +'\n\n'
	)
})
window.addEventListener( 'qjs evaluate progressed', function( event ){

	const 
	length       = 20,
	percent      = Math.round( event.detail.progress * 100 ),
	percentText  = ( ''+ percent ).padStart( 3 ) +'%',
	barLength    = Math.round( length * event.detail.progress ),
	barComplete  = ''.padStart( barLength, '‚ñà' ),
	barRemaining = ''.padStart( length - barLength, '‚ñë' ),
	opsTotal     = event.detail.operationsTotal,
	opsCompleted = ( ''+ event.detail.operationsCompleted ).padStart( Math.log( opsTotal ) * Math.LOG10E + 1 | 0, ' ' )

	console.log( 

		barComplete  + 
		barRemaining +' '+ 
		percentText  +'   '+
		opsCompleted +' of '+
		opsTotal
	)

	
	//  What‚Äôs the actual state of the circuit at this moment?
	//  We should come back and do a cool animated version of this data :)

	const state = event.detail.state
	// console.log( 'state width', state.getWidth(), 'state height', state.getHeight() )
	// console.log( 'state', state.toTsv() )
})
window.addEventListener( 'qjs evaluate completed', function( event ){

	console.log( 

		'\nEvaluation completed for ‚Äú'+ event.detail.circuit.name +'‚Äù'+
		'\nwith these results:\n'+ event.detail.circuit.report$() +'\n\n\n'
	)
	
	const 
	circuit  = event.detail.circuit,
	reportEl = document.getElementById( circuit.name +'-report' )

	if( reportEl ) reportEl.innerText = circuit.report$()
})
window.addEventListener( 'qjs gui altered circuit', function( event ){

	updatePlaygroundFromDom( event.detail.circuit )
})






		</script>
	</body>
</html>